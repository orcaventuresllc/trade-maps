<style>
/* Container Styles */
#insurance-map-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #333;
}

/* Header Styles */
.map-header {
    text-align: center;
    margin-bottom: 30px;
}

.map-header h2 {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #1a1a1a;
}

.map-subtitle {
    font-size: 16px;
    color: #666;
    margin: 0;
}

/* Toggle Button Styles */
.metric-toggles {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.metric-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    color: #555;
}

.metric-btn:hover {
    background: #f5f5f5;
    border-color: #999;
}

.metric-btn.active {
    background: #2563eb;
    color: white;
    border-color: #2563eb;
}

/* Map Container */
.map-content-container {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.map-wrapper {
    position: relative;
    background: #f9fafb;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    flex: 1;
}

#us-map-svg {
    width: 100%;
    height: auto;
    display: block;
}

#us-map-svg svg {
    width: 100%;
    height: auto;
    display: block;
}

/* State Styles */
.state-path {
    stroke: #fff;
    stroke-width: 0.5;
    cursor: pointer;
    transition: all 0.2s ease;
    fill: #e5e7eb;
}

.state-path:hover {
    stroke: #333;
    stroke-width: 1.5;
    filter: brightness(0.9);
}

.state-path.selected {
    stroke: #2563eb;
    stroke-width: 2;
    fill: #93c5fd !important;
}

/* Heat Map Colors */
.heat-0 { fill: #fee2e2; }
.heat-1 { fill: #fecaca; }
.heat-2 { fill: #fca5a5; }
.heat-3 { fill: #f87171; }
.heat-4 { fill: #ef4444; }
.heat-5 { fill: #dc2626; }
.heat-6 { fill: #b91c1c; }
.heat-7 { fill: #991b1b; }

/* Info Section */
.info-section {
    width: 320px;
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.info-card {
    background: #f9fafb;
    border-radius: 8px;
    padding: 20px;
}

.state-name {
    font-size: 24px;
    font-weight: 600;
    color: #2563eb;
    margin-bottom: 10px;
}

.metric-value {
    font-size: 32px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 10px;
}

.metric-description {
    color: #666;
    line-height: 1.5;
}

/* Legend */
.legend-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
    gap: 15px;
}

.legend-label {
    font-weight: 600;
    color: #555;
}

.legend-gradient {
    width: 200px;
    height: 20px;
    background: linear-gradient(to right, #fee2e2, #991b1b);
    border-radius: 10px;
}

.legend-min, .legend-max {
    font-size: 12px;
    color: #888;
}

@media (max-width: 768px) {
    .map-content-container {
        flex-direction: column;
    }
    
    .info-section {
        width: 100%;
    }
}
</style>

<div id="insurance-map-container">
    <div class="map-header">
        <h2>Carpenter Insurance Cost Metrics by State</h2>
        <p class="map-subtitle">Explore insurance costs and savings opportunities across the United States</p>
    </div>
    
    <div class="metric-toggles">
        <button class="metric-btn active" data-metric="glPremiumPct">
            GL Premium % of Revenue
        </button>
        <button class="metric-btn" data-metric="glSavingsPct">
            GL Savings %
        </button>
        <button class="metric-btn" data-metric="glCompetitiveness">
            GL Carrier Competitiveness
        </button>
        <button class="metric-btn" data-metric="wcRate">
            WC Rate per $100
        </button>
    </div>
    
    <div class="legend-container">
        <span class="legend-label">Legend:</span>
        <span class="legend-min">Low</span>
        <div class="legend-gradient"></div>
        <span class="legend-max">High</span>
    </div>
    
    <div class="map-content-container">
        <div class="map-wrapper">
            <div id="us-map-svg">
                <svg viewBox="0 0 959 593" width="959" height="593" xmlns="http://www.w3.org/2000/svg">
                    <g class="state">
                        <path id="state-AL" class="state-path" d="m 643,467.4 .4,-7.3 -.9,-1.2 -1.7,-.7 -2.5,-2.8 .5,-2.9 48.8,-5.1 -.7,-2.2 -1.5,-1.5 -.5,-1.4 .6,-6.3 -2.4,-5.7 .5,-2.6 .3,-3.7 2.2,-3.8 -.2,-1.1 -1.7,-1 v -3.2 l -1.8,-1.9 -2.9,-6.1 -12.9,-45.8 -45.7,4 1.3,2 -1.3,67 4.4,33.2 .9,-.5 1.3,.1 .6,.4 .8,-.1 2,-3.8 v -2.3 l 1.1,-1.1 1.4,.5 3.4,6.4 v .9 l -3.3,2.2 3.5,-.4 4.9,-1.6 z"></path>
                        <path id="state-AK" class="state-path" d="m 15.8,572 h 2.4 l .7,.7 -1,1.2 -1.9,.2 -2.5,1.3 -3.7,-.1 2.2,-.9 .3,-1.1 2.5,-.3 z m 8.3,-1.7 1.3,.5 h .9 l .5,1.2 .3,-.6 .9,.2 1.1,1.5 0,.5 -4.2,1.9 -2.4,-.1 -1,-.5 -1.1,.7 -2,0 -1.1,-1.4 4.7,-.5 z"></path>
                        <path id="state-AZ" class="state-path" d="m 139.6,387.6 3,-2.2 .8,-2.4 -1,-1.6 -1.8,-.2 -1.1,-1.6 1.1,-6.9 1.6,-.3 2.4,-3.2 1.6,-7 2.4,-3.6 4.8,-1.7 1.3,-1.3 -.4,-1.9 -2.3,-2.5 -1.2,-5.8 -1.4,-1.8 -1.3,-3.4 .9,-2.1 1.4,-3 .5,-2.9 -.5,-4.9 1,-13.6 3.5,-.6 3.7,1.4 1.2,2.7 h 2 l 2.4,-2.9 3.4,-17.5 46.2,8.2 40,6 -17.4,124.1 -37.3,-5.4 -64.2,-37.5 .5,-2.9 2,-1.8 z"></path>
                        <path id="state-AR" class="state-path" d="m 584.2,367 .9,-2.2 1.2,.5 .7,-1 -.8,-.7 .3,-1.5 -1.1,-.9 .6,-1 -.1,-1.5 -1.1,-.1 .8,-.8 1.3,.8 .3,-1.4 -.4,-1.1 .1,-.7 2,.6 -.4,-1.5 1.6,-1.3 -.5,-.9 -1.1,.1 -.6,-.9 .9,-.9 1.6,-.2 .5,-.8 1.4,-.2 -.1,-.8 -.9,-.9 v -.5 h 1.5 l .4,-.7 -1.4,-1 -.1,-.6 -11.2,.8 2.8,-5.1 1.7,-1.5 v -2.2 l -1.6,-2.5 -39.8,2 -39.1,.7 4.1,24.4 -.7,39 2.6,2.3 2.8,-1.3 3.2,.8 .2,11.9 52.3,-1.3 1.2,-1.5 .5,-3 -1.5,-2.3 -.5,-2.2 .9,-.7 v -.8 l -1.7,-1.1 -.1,-.7 1.6,-.9 -1.2,-1.1 1.7,-7.1 3.4,-1.6 v -.8 l -1.1,-1.4 2.9,-5.4 h 1.9 l 1.5,-1.2 -.3,-5.2 3.1,-4.5 1.8,-.6 -.5,-3.1 z"></path>
                        <path id="state-CA" class="state-path" d="m 69.4,365.6 3.4,5.2 -1.4,.1 -1.8,-1.9 z m 1.9,-9.8 1.8,4.1 2.6,1 .7,-.6 -1.3,-2.5 -2.6,-2.4 z m -19.9,-19 v 2.4 l 2,1.2 4.4,-.2 1,-1 -3.1,-.2 z m -5.9,.1 3.3,.5 1.4,2.2 h -3.8 z m 47.9,45.5 -1,-3 .2,-3 -.4,-7.9 -1.8,-4.8 -1.2,-1.4 -.6,-1.5 -7,-8.6 -3.6,.1 -2,-1.9 1.1,-1.8 -.7,-3.7 -2.2,-1.2 -3.9,-.6 -2.8,-1.3 -1.5,-1.9 -4.5,-6.6 -2.7,-2.2 -3.7,-.5 -3.1,-2.3 -4.7,-1.5 -2.8,-.3 -2.5,-2.5 .2,-2.8 .8,-4.8 1.8,-5.1 -1.4,-1.6 -4,-9.4 -2.7,-3.7 -.4,-3 -1.6,-2.3 .2,-2.5 -2,-5 -2.9,-2.7 .6,-7.1 2.4,-.8 1.8,-3.1 -.4,-3.2 -1,-.9 h -2.5 l -2.5,-3.3 -1.5,-3.5 v -7.5 l 1.2,-4.2 .2,-2.1 2.5,.2 -.1,1.6 -.8,.7 v 2.5 l 3.7,3.2 v -4.7 l -1.4,-3.4 .5,-1.1 -1,-1.7 2.8,-1.5 -1.9,-3 -1.4,.5 -1.5,3.8 .5,1.3 -.8,1 -.9,-.1 -5.4,-6.1 .7,-5.6 -1.1,-3.9 -6.5,-12.8 .8,-10.7 2.3,-3.6 .2,-6.4 -5.5,-11.1 .3,-5.2 6.9,-7.5 1.7,-2.4 -.1,-1.4 4,-9.2 .1,-8.4 .9,-2.5 66.1,18.6 -16.4,63.1 1.1,3.5 70.4,105 -.9,2.1 1.3,3.4 1.4,1.8 1.2,5.8 2.3,2.5 .4,1.9 -1.3,1.3 -4.8,1.7 -2.4,3.6 -1.6,7 -2.4,3.2 -1.6,.3 -1.1,6.9 1.1,1.6 1.8,.2 1,1.6 -.8,2.4 -3,2.2 -2.2,-.1 z"></path>
                        <path id="state-CO" class="state-path" d="m 374.6,323.3 -16.5,-1 -51.7,-4.8 -52.6,-6.5 11.5,-88.3 44.9,5.7 37.5,3.4 33.1,2.4 -1.4,22.1 z"></path>
                        <path id="state-CT" class="state-path" d="m 873.5,178.9 .4,-1.1 -3.2,-12.3 -.1,-.3 -14.9,3.4 v .7 l -.9,.3 -.5,-.7 -10.5,2.4 2.8,16.3 1.8,1.5 -3.5,3.4 1.7,2.2 5.4,-4.5 1.7,-1.3 h .8 l 2.4,-3.1 1.4,.1 2.9,-1.1 h 2.1 l 5.3,-2.7 2.8,-.9 1,-1 1.5,.5 z"></path>
                        <path id="state-DE" class="state-path" d="m 822.2,226.6 -1.6,.3 -1.5,1.1 -1.2,2.1 7.6,27.1 10.9,-2.3 -2.2,-7.6 -1.1,.5 -3.3,-2.6 -.5,-1.7 -1.8,-1 -.2,-3.7 -2.1,-2.2 -1.1,-.8 -1.2,-1.1 -.4,-3.2 .3,-2.1 1,-2.2 z"></path>
                        <path id="state-FL" class="state-path" d="m 751.7,445.1 -4,-.7 -1.7,-.9 -2.2,1.4 v 2.5 l 1.4,2.1 -.5,4.3 -2.1,.6 -1,-1.1 -.6,-3.2 -50.1,3.3 -3.3,-6 -48.8,5.1 -.5,2.9 2.5,2.8 1.7,.7 .9,1.2 -.4,7.3 -1.1,.6 .5,.4 1,-.3 .7,-.8 10.5,-2.7 9.2,-.5 8.1,1.9 8.5,5 2.4,.8 2.2,2 -.1,2.7 h 2.4 l 1.9,-1 2.5,.1 2,-.8 2.9,-2 3.1,-2.9 1.1,-.4 .6,.5 h 1.4 l .5,-.8 -.5,-1.2 -.6,-.6 .2,-.8 2,-1.1 5,-.4 .8,1 1,.1 2.3,1 3,1.8 1.2,1.7 1.1,1.2 2.8,1.4 v 2.4 l 2.8,1.9 1,.1 1.6,1.4 .7,1.6 1,.2 .8,2.1 .7,.6 1,-1.1 2.9,.1 .5,1.4 1.1,.9 v 1.3 l 2.9,2.2 .2,9.6 -1.8,5.8 1,1.2 -.2,3.4 -.8,1.4 .7,1.2 2.3,2.3 .3,1.5 .8,1 -.4,-1.9 1.3,-.6 .8,-3.6 -3,-1.2 .1,-.6 2.6,-.4 .9,2.6 1.1,.6 .1,-2 1.1,.3 .6,.8 -.1,.7 -2.9,4.2 -.2,1.1 -1.7,1.9 v 1.1 l 3.7,3.8 5.3,7.9 1.8,2.1 v 1.8 l 2.8,4.6 2.3,.6 .7,-1.2 -2.1,.3 -3,-4.5 .2,-1.4 1.5,-.8 v -1.5 l -.6,-1.3 .9,-.9 .4,.9 .7,.5 v 4 l -1.2,-.6 -.8,.9 1.4,1.6 1,2.6 1.2,-.6 2.3,1.2 2.1,2.2 1.6,5.1 3.1,4.8 .8,-1.3 2.8,-.5 3.2,1.3 .3,1.7 3.3,3.8 .1,1.1 2.2,2.7 -.7,.5 v 2.7 l 2.7,1.4 h 1.5 l 2.7,-1.8 1.5,.3 1.1,.4 2.3,-1.7 .2,-.7 1.2,.3 2.4,-1.7 1.3,-2.3 -.7,-3.2 -.2,-1.3 1.1,-4 .6,-.2 .6,1.6 .8,-1.8 -.8,-7.2 -.4,-10.5 -1,-6.8 -.7,-1.7 -6.6,-11.1 -5.2,-9.1 -2.2,-3.3 -1.3,-3.6 -.2,-3.4 .9,-.3 v -.9 l -1.1,-2.2 -4,-4 -7.6,-9.7 -5.7,-10.4 -4.3,-10.7 -.6,-3.7 -1.2,-1 -.5,-3.8 z"></path>
                        <!-- Add more states here with their actual path data -->
                    </g>
                </svg>
            </div>
        </div>
        
        <div class="info-section">
            <div class="info-card">
                <h3 class="state-name">Select a State</h3>
                <div class="metric-value">--</div>
                <p class="metric-description">Click on a state to view insurance metrics</p>
            </div>
        </div>
    </div>
</div>

<script>
console.log('WordPress map script starting - DOM should be ready');

(function() {
    // Simple data structure
    window.DATA = {
        glPremiumPct: {
            AL: 3.9, AK: 4.5, AZ: 3.6, AR: 3.8, CA: 4.3,
            CO: 3.5, CT: 4.1, DE: 3.7, FL: 4.5, GA: 3.9
            // Add more states as needed
        },
        glSavingsPct: {
            AL: 18, AK: 22, AZ: 20, AR: 19, CA: 25,
            CO: 21, CT: 23, DE: 20, FL: 26, GA: 19
        },
        glCompetitiveness: {
            AL: 65, AK: 45, AZ: 75, AR: 60, CA: 85,
            CO: 80, CT: 70, DE: 65, FL: 90, GA: 75
        },
        wcRate: {
            AL: 6.14, AK: 6.16, AZ: 4.05, AR: 3.26, CA: 5.62,
            CO: 4.74, CT: 7.86, DE: 5.00, FL: 6.23, GA: 8.98
        }
    };
    
    window.currentMetric = 'glPremiumPct';
    window.selectedState = null;
    
    // Simple function to update map colors
    function updateMapColors() {
        console.log('Updating map colors for metric:', window.currentMetric);
        
        var metricData = window.DATA[window.currentMetric];
        if (!metricData) return;
        
        // Get min and max values
        var values = [];
        for (var state in metricData) {
            values.push(metricData[state]);
        }
        var min = Math.min.apply(Math, values);
        var max = Math.max.apply(Math, values);
        
        // Update each state
        var states = document.querySelectorAll('.state-path');
        for (var i = 0; i < states.length; i++) {
            var state = states[i];
            var stateCode = state.id.replace('state-', '');
            var value = metricData[stateCode];
            
            if (value !== undefined) {
                // Remove old heat classes
                for (var j = 0; j <= 7; j++) {
                    state.classList.remove('heat-' + j);
                }
                
                // Calculate heat level
                var normalized = (value - min) / (max - min);
                var heatLevel = Math.floor(normalized * 8);
                heatLevel = Math.min(7, Math.max(0, heatLevel));
                
                // Add new heat class
                state.classList.add('heat-' + heatLevel);
            }
        }
    }
    
    // Handle state click
    function handleStateClick(stateCode) {
        console.log('State clicked:', stateCode);
        
        // Get state element
        var state = document.getElementById('state-' + stateCode);
        if (!state) return;
        
        // Toggle selection
        var wasSelected = state.classList.contains('selected');
        
        // Clear all selections
        var allStates = document.querySelectorAll('.state-path');
        for (var i = 0; i < allStates.length; i++) {
            allStates[i].classList.remove('selected');
        }
        
        if (!wasSelected) {
            state.classList.add('selected');
            window.selectedState = stateCode;
            updateInfoCard(stateCode);
        } else {
            window.selectedState = null;
            updateInfoCard(null);
        }
    }
    
    // Update info card
    function updateInfoCard(stateCode) {
        var nameEl = document.querySelector('.state-name');
        var valueEl = document.querySelector('.metric-value');
        var descEl = document.querySelector('.metric-description');
        
        if (stateCode) {
            var value = window.DATA[window.currentMetric][stateCode];
            if (nameEl) nameEl.textContent = stateCode;
            if (valueEl) valueEl.textContent = value || '--';
            if (descEl) descEl.textContent = 'Current metric: ' + window.currentMetric;
        } else {
            if (nameEl) nameEl.textContent = 'Select a State';
            if (valueEl) valueEl.textContent = '--';
            if (descEl) descEl.textContent = 'Click on a state to view insurance metrics';
        }
    }
    
    // Handle metric toggle
    function handleMetricToggle(metric) {
        console.log('Metric toggled:', metric);
        
        // Update active button
        var buttons = document.querySelectorAll('.metric-btn');
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove('active');
        }
        
        var activeBtn = document.querySelector('[data-metric="' + metric + '"]');
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
        
        // Update current metric
        window.currentMetric = metric;
        
        // Update map colors
        updateMapColors();
        
        // Update info card if state selected
        if (window.selectedState) {
            updateInfoCard(window.selectedState);
        }
    }
    
    // Add event listeners to states
    console.log('Adding event listeners to states...');
    var states = document.querySelectorAll('.state-path');
    for (var i = 0; i < states.length; i++) {
        (function(state) {
            var stateCode = state.id.replace('state-', '');
            state.addEventListener('click', function() {
                handleStateClick(stateCode);
            });
        })(states[i]);
    }
    console.log('Added listeners to ' + states.length + ' states');
    
    // Add event listeners to buttons
    console.log('Adding event listeners to buttons...');
    var buttons = document.querySelectorAll('.metric-btn');
    for (var j = 0; j < buttons.length; j++) {
        (function(btn) {
            btn.addEventListener('click', function() {
                handleMetricToggle(btn.getAttribute('data-metric'));
            });
        })(buttons[j]);
    }
    console.log('Added listeners to ' + buttons.length + ' buttons');
    
    // Initialize map colors
    updateMapColors();
    
    console.log('Map initialization complete!');
})();
</script>